{"remainingRequest":"/Users/linqingguang/Documents/文稿/项目/微信实时聊天/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/linqingguang/Documents/文稿/项目/微信实时聊天/client/src/views/ChatView.vue?vue&type=style&index=0&id=96f3dc52&scoped=true&lang=css&","dependencies":[{"path":"/Users/linqingguang/Documents/文稿/项目/微信实时聊天/client/src/views/ChatView.vue","mtime":1560165860088},{"path":"/Users/linqingguang/Documents/文稿/项目/微信实时聊天/client/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/linqingguang/Documents/文稿/项目/微信实时聊天/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/linqingguang/Documents/文稿/项目/微信实时聊天/client/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/linqingguang/Documents/文稿/项目/微信实时聊天/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/linqingguang/Documents/文稿/项目/微信实时聊天/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.chat {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.container {\n  width: 100%;\n  height: calc(100% - 100px);\n  box-sizing: border-box;\n  background-color: #f1f1f1;\n  margin-top: 50px;\n  padding: 8px;\n  overflow-y: scroll;\n}\n.footer_wrap {\n  width: 100%;\n  height: 50px;\n  box-sizing: border-box;\n  border-top: 1px solid #d9d9d9;\n  position: absolute;\n  bottom: 0;\n  padding: 8px;\n  background-color: #fafafa;\n}\n.footer_wrap input {\n  width: 70%;\n  height: 30px;\n  outline: none;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n}\n.footer_wrap button {\n  width: 20%;\n  height: 34px;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n  margin-left: 8px;\n  outline: none;\n  background-color: #f1f1f1;\n}\n.footer_wrap button[disabled] {\n  background-color: #d9d9d9;\n  cursor: not-allowed;\n  pointer-events: none;\n}\n\n.left_msg {\n  justify-content: flex-start;\n}\n.right_msg {\n  justify-content: flex-end;\n}\n.left_msg,\n.right_msg {\n  width: 100%;\n  display: flex;\n  margin: 5px 0;\n}\n.content_wrap img {\n  width: 3rem;\n  height: 3rem;\n}\n.content_wrap span {\n  display: inline-block;\n  max-width: 65%;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n  margin: 0 5px;\n  padding: 8px;\n  box-sizing: border-box;\n  word-break: break-all;\n}\n.left_msg span {\n  background-color: #fff;\n}\n.right_msg span {\n  background-color: #0fce0d;\n}\n",{"version":3,"sources":["ChatView.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChatView.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"chat\">\n    <Header v-if=\"targetUser\" :is-left=\"true\" :title=\"targetUser.name\" btn_icon=\"ellipsis-h\"/>\n\n    <div class=\"container\">\n      <!-- 聊天内容 -->\n      <div\n        class=\"content_wrap\"\n        :v-if=\"targetUser && user\"\n        v-for=\"(item,index) in messageList\"\n        :key=\"index\"\n      >\n        <!-- 别人的内容 -->\n        <div class=\"left_msg\" v-if=\"item.source == 'other'\">\n          <img :src=\"targetUser.avatar\" alt>\n          <span>{{item.msg}}</span>\n        </div>\n        <!-- 我的内容 -->\n        <div class=\"right_msg\" v-if=\"item.source=='self'\">\n          <span>{{item.msg}}</span>\n          <img :src=\"user.avatar\" alt>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"footer_wrap\">\n      <input type=\"text\" v-model=\"msgValue\">\n      <button :disabled=\"msgValue == ''\" @click=\"sendMessage\">发送</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Header from \"../components/Header\";\nimport WSocket from \"../socket.js\";\nexport default {\n  data() {\n    return {\n      targetUser: null,\n      msgValue: \"\",\n      messageList: []\n    };\n  },\n  components: {\n    Header\n  },\n  beforeRouteEnter(to, from, next) {\n    next(vm => {\n      vm.targetUser = to.params.user;\n      vm.getMessage();\n    });\n  },\n  computed: {\n    user() {\n      return this.$store.getters.user;\n    }\n  },\n  // 服务端推送消息给客户端\n  mounted() {\n    //WSocket.init(用户，信息，错误)\n    WSocket.init(\n      //用户\n      { user: this.user },\n      //信息\n      message => {\n        // 收到消息后,将消息存储到数据中\n        this.messageList.push({\n          msg: message.msg,\n          source: \"other\"\n        });\n        // 保存消息\n        this.saveMsg();\n      },\n      //错误 \n      error => {\n        console.log(error);\n      }\n    );\n  },\n  methods: {\n    sendMessage() {\n      // console.log(this.msgValue);\n      // 需要发送的消息对象\n      const msgObj = {\n        target: this.targetUser._id,\n        current: this.user.id,\n        msg: this.msgValue\n      };\n\n      WSocket.send(msgObj);\n\n      // 本地客户端显示\n      this.messageList.push({\n        msg: this.msgValue,\n        source: \"self\"\n      });\n\n      // 保存消息\n      this.saveMsg();\n\n      // 清空input\n      this.msgValue = \"\";\n    },\n    saveMsg() {\n      // 保存消息\n      let message = {\n        target: {\n          avatar: this.targetUser.avatar,\n          name: this.targetUser.name,\n          _id: this.targetUser._id\n        },\n        count: 0,\n        message: this.messageList,\n        user_id: this.user.id\n      };\n      this.$axios\n        .post(\"/api/profile/addmsg\", message)\n        .then(res => (this.msgValue = \"\"));\n    },\n    getMessage() {\n      this.$axios(`/api/profile/msg/${this.user.id}`).then(res => {\n        // console.log(res.data);\n        // 过滤与当前目标对象的聊天数据\n        let result = res.data.filter(data => {\n          // console.log(data.target._id);\n          // console.log(this.targetUser._id);\n          return data.target._id == this.targetUser._id;\n        });\n\n        if (result.length > 0) {\n          this.messageList = result[0].message;\n        }\n      });\n    }\n  }\n};\n</script>\n<style scoped>\n.chat {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.container {\n  width: 100%;\n  height: calc(100% - 100px);\n  box-sizing: border-box;\n  background-color: #f1f1f1;\n  margin-top: 50px;\n  padding: 8px;\n  overflow-y: scroll;\n}\n.footer_wrap {\n  width: 100%;\n  height: 50px;\n  box-sizing: border-box;\n  border-top: 1px solid #d9d9d9;\n  position: absolute;\n  bottom: 0;\n  padding: 8px;\n  background-color: #fafafa;\n}\n.footer_wrap input {\n  width: 70%;\n  height: 30px;\n  outline: none;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n}\n.footer_wrap button {\n  width: 20%;\n  height: 34px;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n  margin-left: 8px;\n  outline: none;\n  background-color: #f1f1f1;\n}\n.footer_wrap button[disabled] {\n  background-color: #d9d9d9;\n  cursor: not-allowed;\n  pointer-events: none;\n}\n\n.left_msg {\n  justify-content: flex-start;\n}\n.right_msg {\n  justify-content: flex-end;\n}\n.left_msg,\n.right_msg {\n  width: 100%;\n  display: flex;\n  margin: 5px 0;\n}\n.content_wrap img {\n  width: 3rem;\n  height: 3rem;\n}\n.content_wrap span {\n  display: inline-block;\n  max-width: 65%;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n  margin: 0 5px;\n  padding: 8px;\n  box-sizing: border-box;\n  word-break: break-all;\n}\n.left_msg span {\n  background-color: #fff;\n}\n.right_msg span {\n  background-color: #0fce0d;\n}\n</style>\n"]}]}